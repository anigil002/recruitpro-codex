<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>RecruitPro Console</title>
    <script defer src="./scripts/init-backend.js"></script>
    <style>
      :root {
        color-scheme: dark light;
        font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        --bg: linear-gradient(160deg, #020617 0%, #0f172a 45%, #111827 100%);
        --surface: rgba(15, 23, 42, 0.9);
        --surface-soft: rgba(15, 23, 42, 0.65);
        --border: rgba(148, 163, 184, 0.15);
        --border-strong: rgba(148, 163, 184, 0.35);
        --text: #e2e8f0;
        --text-muted: #94a3b8;
        --accent: #3b82f6;
        --accent-soft: rgba(59, 130, 246, 0.12);
        --accent-strong: rgba(59, 130, 246, 0.4);
        --success: #22c55e;
        --warning: #f59e0b;
        --danger: #ef4444;
        background-color: #020617;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        min-height: 100vh;
        background: var(--bg);
        color: var(--text);
        display: flex;
        justify-content: center;
        align-items: stretch;
        padding: 32px 20px;
      }

      a {
        color: inherit;
      }

      h1,
      h2,
      h3,
      h4 {
        margin: 0;
        font-weight: 600;
      }

      p {
        margin: 0;
      }

      button,
      input,
      select,
      textarea {
        font: inherit;
      }

      .app-shell {
        width: min(1400px, 100%);
        display: flex;
        flex-direction: column;
        gap: 32px;
      }

      .glass-card {
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: 18px;
        box-shadow: 0 35px 65px -40px rgba(15, 118, 255, 0.65);
        backdrop-filter: blur(14px);
      }

      /* Login screen */
      .login-screen {
        flex: 1;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      .login-card {
        width: min(460px, 100%);
        padding: 36px;
        display: flex;
        flex-direction: column;
        gap: 24px;
      }

      .login-card header {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .login-card header span {
        color: var(--text-muted);
      }

      .login-card form {
        display: flex;
        flex-direction: column;
        gap: 16px;
      }

      .field {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .field label {
        font-size: 0.95rem;
        color: var(--text-muted);
      }

      .input {
        padding: 12px 14px;
        border-radius: 12px;
        border: 1px solid var(--border);
        background: rgba(15, 23, 42, 0.55);
        color: var(--text);
      }

      .primary-btn {
        align-self: flex-start;
        border: none;
        border-radius: 999px;
        padding: 12px 24px;
        background: linear-gradient(120deg, #2563eb, #38bdf8);
        color: #0b1220;
        font-weight: 600;
        cursor: pointer;
        transition: transform 120ms ease, box-shadow 120ms ease;
      }

      .primary-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 18px 45px -28px rgba(56, 189, 248, 0.9);
      }

      .primary-btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
      }

      /* Authenticated layout */
      .app-layout {
        display: none;
        min-height: 720px;
      }

      .app-layout[data-state="visible"] {
        display: grid;
        grid-template-columns: 270px minmax(0, 1fr);
        gap: 24px;
      }

      .sidebar {
        position: sticky;
        top: 0;
        align-self: start;
        display: flex;
        flex-direction: column;
        height: 100%;
        padding: 28px 24px;
        gap: 32px;
      }

      .brand {
        display: flex;
        align-items: center;
        gap: 10px;
        font-weight: 700;
        letter-spacing: 0.03em;
      }

      .brand span:first-child {
        width: 40px;
        height: 40px;
        display: grid;
        place-items: center;
        border-radius: 12px;
        background: var(--accent);
        color: #0b1220;
        font-weight: 700;
      }

      .nav {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .nav-button {
        border: none;
        background: transparent;
        color: var(--text-muted);
        padding: 12px 14px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        gap: 12px;
        justify-content: flex-start;
        cursor: pointer;
        font-weight: 500;
        transition: background 0.2s ease, color 0.2s ease, transform 0.2s ease;
      }

      .nav-button::before {
        content: "";
        width: 8px;
        height: 8px;
        border-radius: 999px;
        background: var(--border);
        transition: background 0.2s ease;
      }

      .nav-button:hover {
        background: rgba(59, 130, 246, 0.16);
        color: var(--text);
      }

      .nav-button.is-active {
        background: rgba(59, 130, 246, 0.25);
        color: var(--text);
        transform: translateX(4px);
      }

      .nav-button.is-active::before {
        background: var(--accent);
      }

      .sidebar-footer {
        margin-top: auto;
        display: flex;
        flex-direction: column;
        gap: 12px;
        font-size: 0.85rem;
        color: var(--text-muted);
      }

      .logout-btn {
        border: 1px solid var(--border);
        border-radius: 999px;
        padding: 10px 18px;
        color: inherit;
        background: transparent;
        cursor: pointer;
        transition: background 0.2s ease, border-color 0.2s ease;
      }

      .logout-btn:hover {
        background: rgba(148, 163, 184, 0.15);
        border-color: var(--border-strong);
      }

      .content-surface {
        padding: 28px;
        display: flex;
        flex-direction: column;
        gap: 24px;
      }

      .topbar {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
        align-items: center;
        gap: 16px;
      }

      .topbar h1 {
        font-size: 1.6rem;
        font-weight: 600;
      }

      .topbar-actions {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .search-input {
        padding: 10px 16px;
        border-radius: 999px;
        border: 1px solid var(--border);
        background: rgba(2, 6, 23, 0.55);
        color: var(--text);
        min-width: 220px;
      }

      .chip {
        padding: 6px 12px;
        border-radius: 999px;
        background: rgba(59, 130, 246, 0.14);
        border: 1px solid rgba(59, 130, 246, 0.45);
        color: var(--text);
        font-size: 0.8rem;
        font-weight: 600;
      }

      .view {
        display: none;
        flex-direction: column;
        gap: 24px;
      }

      .view[data-state="active"] {
        display: flex;
      }

      .grid {
        display: grid;
        gap: 18px;
      }

      .grid.two {
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      }

      .grid.three {
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      }

      .stat-card {
        padding: 20px;
        border-radius: 16px;
        border: 1px solid var(--border);
        background: var(--surface-soft);
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .stat-card .label {
        font-size: 0.85rem;
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 0.04em;
      }

      .stat-card strong {
        font-size: 2rem;
      }

      .stat-card footer {
        font-size: 0.85rem;
        color: var(--text-muted);
      }

      .panel {
        padding: 24px;
        border-radius: 18px;
        border: 1px solid var(--border);
        background: var(--surface-soft);
        display: flex;
        flex-direction: column;
        gap: 16px;
      }

      .featured-card {
        padding: 20px;
        border-radius: 16px;
        border: 1px solid rgba(59, 130, 246, 0.35);
        background: rgba(59, 130, 246, 0.12);
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .featured-card h4 {
        font-size: 1.05rem;
        font-weight: 600;
      }

      .featured-card p {
        color: var(--text-muted);
        font-size: 0.9rem;
        margin: 0;
      }

      .chip-list {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
        margin-top: 4px;
      }

      .chip-list .chip {
        padding: 4px 10px;
        font-size: 0.75rem;
        border-radius: 999px;
        background: rgba(59, 130, 246, 0.18);
        border: 1px solid rgba(59, 130, 246, 0.45);
        color: var(--text);
      }

      .empty-state {
        color: var(--text-muted);
        font-size: 0.9rem;
        padding: 12px 0;
      }

      .table-empty {
        text-align: left;
        color: var(--text-muted);
        padding: 18px 12px;
      }

      .panel header {
        display: flex;
        justify-content: space-between;
        gap: 12px;
        align-items: center;
      }

      .panel header h3 {
        font-size: 1.1rem;
      }

      .panel header span {
        color: var(--text-muted);
        font-size: 0.9rem;
      }

      .timeline {
        list-style: none;
        margin: 0;
        padding: 0;
        display: flex;
        flex-direction: column;
        gap: 18px;
      }

      .timeline-item {
        display: grid;
        grid-template-columns: auto 1fr;
        gap: 16px;
        align-items: start;
      }

      .timeline-item::before {
        content: "";
        width: 12px;
        height: 12px;
        border-radius: 999px;
        background: var(--accent);
        margin-top: 6px;
        box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.25);
      }

      .timeline-item.empty::before {
        background: transparent;
        box-shadow: none;
      }

      .timeline-item strong {
        display: block;
        font-weight: 600;
        margin-bottom: 4px;
      }

      .timeline-item span {
        color: var(--text-muted);
        font-size: 0.85rem;
      }

      .table {
        width: 100%;
        border-collapse: collapse;
      }

      .table thead {
        color: var(--text-muted);
        font-size: 0.8rem;
        text-transform: uppercase;
        letter-spacing: 0.04em;
      }

      .table th,
      .table td {
        padding: 14px 12px;
        border-bottom: 1px solid rgba(148, 163, 184, 0.08);
      }

      .table tbody tr:hover {
        background: rgba(148, 163, 184, 0.08);
      }

      .badge {
        border-radius: 999px;
        padding: 4px 10px;
        font-size: 0.75rem;
        font-weight: 600;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        border: 1px solid transparent;
      }

      .badge.success {
        background: rgba(34, 197, 94, 0.15);
        border-color: rgba(34, 197, 94, 0.35);
        color: var(--success);
      }

      .badge.warning {
        background: rgba(245, 158, 11, 0.15);
        border-color: rgba(245, 158, 11, 0.35);
        color: var(--warning);
      }

      .badge.info {
        background: rgba(59, 130, 246, 0.15);
        border-color: rgba(59, 130, 246, 0.35);
        color: var(--accent);
      }

      .quick-actions {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
      }

      .quick-actions a {
        display: inline-flex;
        align-items: center;
        gap: 10px;
        padding: 10px 16px;
        border-radius: 999px;
        border: 1px solid var(--border);
        background: rgba(148, 163, 184, 0.08);
        color: inherit;
        text-decoration: none;
        font-size: 0.9rem;
        transition: transform 0.2s ease, border-color 0.2s ease;
      }

      .quick-actions a:hover {
        transform: translateY(-1px);
        border-color: var(--accent-strong);
      }

      @media (max-width: 1100px) {
        body {
          padding: 24px 12px;
        }

        .app-layout[data-state="visible"] {
          grid-template-columns: 1fr;
        }

        .sidebar {
          position: relative;
          flex-direction: row;
          flex-wrap: wrap;
          justify-content: space-between;
          gap: 16px;
        }

        .nav {
          flex-direction: row;
          flex-wrap: wrap;
          gap: 10px;
        }

        .nav-button {
          padding: 10px 14px;
        }

        .nav-button::before {
          display: none;
        }

        .sidebar-footer {
          width: 100%;
          flex-direction: row;
          justify-content: space-between;
          align-items: center;
        }
      }

      @media (max-width: 640px) {
        body {
          padding: 16px 10px;
        }

        .login-card {
          padding: 28px;
        }

        .content-surface {
          padding: 22px;
        }

        .search-input {
          min-width: 0;
          width: 100%;
        }
      }
    </style>
  </head>
  <body>
    <div class="app-shell">
      <section class="login-screen" id="loginScreen">
        <article class="glass-card login-card">
          <header>
            <div class="chip">Private Console</div>
            <h1>Welcome back to RecruitPro</h1>
            <span>Sign in to review pipelines, manage candidates and launch AI sourcing campaigns.</span>
          </header>
          <form id="loginForm" novalidate>
            <div class="field">
              <label for="email">Work Email</label>
              <input class="input" type="email" id="email" name="email" placeholder="you@company.com" required />
            </div>
            <div class="field">
              <label for="password">Password</label>
              <input class="input" type="password" id="password" name="password" placeholder="••••••••" required />
            </div>
            <button class="primary-btn" type="submit">Enter dashboard</button>
          </form>
        </article>
      </section>

      <section class="app-layout" id="appLayout">
        <aside class="glass-card sidebar">
          <div class="brand">
            <span>RP</span>
            <div>
              RecruitPro
              <div style="font-size: 0.8rem; color: var(--text-muted); font-weight: 400">Talent OS</div>
            </div>
          </div>
          <nav class="nav" aria-label="Primary navigation">
            <button class="nav-button is-active" data-view-target="dashboard">Dashboard</button>
            <button class="nav-button" data-view-target="projects">Projects</button>
            <button class="nav-button" data-view-target="candidates">Candidates</button>
            <button class="nav-button" data-view-target="positions">Positions</button>
            <button class="nav-button" data-view-target="ai-sourcing">AI Sourcing</button>
            <button class="nav-button" data-view-target="settings">Settings</button>
          </nav>
          <div class="sidebar-footer">
            <div>
              <strong>Ops Status</strong>
              <div>Backend: <span id="backendStatus">Connecting…</span></div>
            </div>
            <button class="logout-btn" type="button" id="logoutButton">Log out</button>
          </div>
        </aside>

        <main class="glass-card content-surface" aria-live="polite">
          <header class="topbar">
            <div>
              <h1 id="viewTitle">Dashboard overview</h1>
              <p style="color: var(--text-muted); font-size: 0.95rem">Track progress across hiring funnels and coordinate teams effortlessly.</p>
            </div>
            <div class="topbar-actions">
              <input class="search-input" type="search" placeholder="Search projects, candidates, positions…" aria-label="Search" />
              <div class="chip">Today <span id="todayDate"></span></div>
            </div>
          </header>

          <section class="view" data-view="dashboard" data-state="active">
            <div class="grid three">
              <article class="stat-card">
                <span class="label">Active projects</span>
                <strong id="dashboardProjectsCount">0</strong>
                <footer id="dashboardProjectsMeta">No projects yet</footer>
              </article>
              <article class="stat-card">
                <span class="label">Candidates in pipeline</span>
                <strong id="dashboardCandidatesCount">0</strong>
                <footer id="dashboardCandidatesMeta">No candidates yet</footer>
              </article>
              <article class="stat-card">
                <span class="label">Interviews scheduled</span>
                <strong id="dashboardInterviewsCount">0</strong>
                <footer id="dashboardInterviewsMeta">No interviews scheduled</footer>
              </article>
            </div>

            <article class="panel">
              <header>
                <h3>Insights</h3>
                <span>Live data sourced from your RecruitPro workspace</span>
              </header>
              <div id="dashboardFeatured" class="featured-card">
                <h4>No candidates spotlighted yet</h4>
                <p>Add candidates to highlight profiles that need your attention.</p>
              </div>
              <div>
                <strong>Next best actions</strong>
                <ul
                  id="dashboardSuggestions"
                  style="list-style: none; margin: 12px 0 0; padding: 0; display: flex; flex-direction: column; gap: 8px"
                >
                  <li class="empty-state">Sign in to load workspace suggestions.</li>
                </ul>
              </div>
            </article>

            <article class="panel">
              <header>
                <h3>Recent activity</h3>
                <span id="activityUpdatedAt">Waiting for updates…</span>
              </header>
              <ul class="timeline" id="recentActivity">
                <li class="timeline-item empty">
                  <div>
                    <strong>No activity recorded</strong>
                    <span>Updates will appear once RecruitPro logs new events.</span>
                  </div>
                  <span></span>
                </li>
              </ul>
            </article>
          </section>

          <section class="view" data-view="projects">
            <article class="panel">
              <header>
                <h3>Project portfolio</h3>
                <span>Monitoring velocity, owners and stage health</span>
              </header>
              <div class="grid two">
                <article class="stat-card">
                  <span class="label">Projects on track</span>
                  <strong id="projectsOnTrackCount">0</strong>
                  <footer id="projectsOnTrackMeta">No data yet</footer>
                </article>
                <article class="stat-card">
                  <span class="label">Needs attention</span>
                  <strong id="projectsAttentionCount">0</strong>
                  <footer id="projectsAttentionMeta">Awaiting updates</footer>
                </article>
              </div>
              <div class="panel" style="background: rgba(15, 23, 42, 0.45); gap: 0">
                <table class="table" aria-label="Project list">
                  <thead>
                    <tr>
                      <th>Project</th>
                      <th>Client</th>
                      <th>Status</th>
                      <th>Target hires</th>
                    </tr>
                  </thead>
                  <tbody id="projectsTableBody">
                    <tr>
                      <td colspan="4" class="table-empty">Sign in to load project data.</td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <div class="quick-actions">
                <a href="./project_page.html">Open project workspace</a>
                <a href="./project_positions.html">Review requisitions</a>
              </div>
            </article>
          </section>

          <section class="view" data-view="candidates">
            <article class="panel">
              <header>
                <h3>Candidate pipelines</h3>
                <span>Across all managed projects</span>
              </header>
              <div class="grid two">
                <article class="stat-card">
                  <span class="label">Active candidates</span>
                  <strong id="candidatesActiveCount">0</strong>
                  <footer id="candidatesActiveMeta">No candidates tracked</footer>
                </article>
                <article class="stat-card">
                  <span class="label">Feedback pending</span>
                  <strong id="candidatesPendingFeedbackCount">0</strong>
                  <footer id="candidatesPendingMeta">All feedback submitted</footer>
                </article>
              </div>
              <div class="panel" style="background: rgba(15, 23, 42, 0.45); gap: 0">
                <table class="table" aria-label="Candidate progress">
                  <thead>
                    <tr>
                      <th>Candidate</th>
                      <th>Role</th>
                      <th>Status</th>
                      <th>Source</th>
                    </tr>
                  </thead>
                  <tbody id="candidatesTableBody">
                    <tr>
                      <td colspan="4" class="table-empty">Candidates will appear once they are added to your workspace.</td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <div class="quick-actions">
                <a href="./candidate_profile.html">Open candidate profile</a>
              </div>
            </article>
          </section>

          <section class="view" data-view="positions">
            <article class="panel">
              <header>
                <h3>Open positions</h3>
                <span>Prioritize upcoming requisitions</span>
              </header>
              <div class="grid two">
                <article class="stat-card">
                  <span class="label">Open requisitions</span>
                  <strong id="positionsOpenCount">0</strong>
                  <footer id="positionsOpenMeta">No open positions</footer>
                </article>
                <article class="stat-card">
                  <span class="label">New requests</span>
                  <strong id="positionsNewCount">0</strong>
                  <footer id="positionsNewMeta">No new requests</footer>
                </article>
              </div>
              <div class="panel" style="background: rgba(15, 23, 42, 0.45); gap: 0">
                <table class="table" aria-label="Positions list">
                  <thead>
                    <tr>
                      <th>Position</th>
                      <th>Department</th>
                      <th>Status</th>
                      <th>Openings</th>
                    </tr>
                  </thead>
                  <tbody id="positionsTableBody">
                    <tr>
                      <td colspan="4" class="table-empty">Create or import positions to see them here.</td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <div class="quick-actions">
                <a href="./project_positions.html">Manage positions</a>
              </div>
            </article>
          </section>

          <section class="view" data-view="ai-sourcing">
            <article class="panel">
              <header>
                <h3>AI sourcing control center</h3>
                <span>Monitor campaigns and automation efficiency</span>
              </header>
              <div class="grid three">
                <article class="stat-card">
                  <span class="label">Active campaigns</span>
                  <strong id="aiActiveJobsCount">0</strong>
                  <footer id="aiActiveJobsMeta">No sourcing jobs running</footer>
                </article>
                <article class="stat-card">
                  <span class="label">Profiles generated</span>
                  <strong id="aiProfilesCount">0</strong>
                  <footer id="aiProfilesMeta">No profiles generated</footer>
                </article>
                <article class="stat-card">
                  <span class="label">Tracked projects</span>
                  <strong id="aiTrackedProjectsCount">0</strong>
                  <footer id="aiTrackedProjectsMeta">No projects tracked yet</footer>
                </article>
              </div>
              <div class="panel" style="background: rgba(15, 23, 42, 0.45); gap: 12px">
                <table class="table" aria-label="AI campaigns">
                  <thead>
                    <tr>
                      <th>Campaign</th>
                      <th>Project</th>
                      <th>Status</th>
                      <th>Progress</th>
                    </tr>
                  </thead>
                  <tbody id="aiJobsTableBody">
                    <tr>
                      <td colspan="4" class="table-empty">Launch a sourcing job to see campaign progress.</td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <div class="quick-actions">
                <a href="./ai_sourcing_overview.html">Launch sourcing overview</a>
              </div>
            </article>
          </section>

          <section class="view" data-view="settings">
            <article class="panel">
              <header>
                <h3>Workspace preferences</h3>
                <span>Tailor RecruitPro to your hiring rituals</span>
              </header>
              <div class="grid two">
                <article class="stat-card">
                  <span class="label">Notification digest</span>
                  <strong>Daily 7:30am</strong>
                  <footer>Configure alerts for hiring managers and recruiters.</footer>
                </article>
                <article class="stat-card">
                  <span class="label">Data sync</span>
                  <strong>ATS + CRM</strong>
                  <footer class="badge success">Live</footer>
                </article>
              </div>
              <div class="panel" style="background: rgba(15, 23, 42, 0.45); gap: 20px">
                <div>
                  <strong>Integrations</strong>
                  <p style="color: var(--text-muted); margin-top: 6px">Connect additional data sources to power your candidate intelligence.</p>
                </div>
                <div class="quick-actions">
                  <a href="./settings.html">Open integrations</a>
                </div>
                <div>
                  <strong>Theme</strong>
                  <p style="color: var(--text-muted); margin-top: 6px">The console adapts to your OS appearance. Dark mode is currently active.</p>
                </div>
              </div>
            </article>
          </section>
        </main>
      </section>
    </div>

    <script>
      const loginScreen = document.getElementById('loginScreen');
      const loginForm = document.getElementById('loginForm');
      const loginButton = loginForm.querySelector('button');
      const appLayout = document.getElementById('appLayout');
      const navButtons = Array.from(document.querySelectorAll('[data-view-target]'));
      const views = Array.from(document.querySelectorAll('.view'));
      const viewTitle = document.getElementById('viewTitle');
      const logoutButton = document.getElementById('logoutButton');
      const backendStatus = document.getElementById('backendStatus');
      const todayDate = document.getElementById('todayDate');
      const activityUpdatedAt = document.getElementById('activityUpdatedAt');

      const elements = {
        dashboardProjectsCount: document.getElementById('dashboardProjectsCount'),
        dashboardProjectsMeta: document.getElementById('dashboardProjectsMeta'),
        dashboardCandidatesCount: document.getElementById('dashboardCandidatesCount'),
        dashboardCandidatesMeta: document.getElementById('dashboardCandidatesMeta'),
        dashboardInterviewsCount: document.getElementById('dashboardInterviewsCount'),
        dashboardInterviewsMeta: document.getElementById('dashboardInterviewsMeta'),
        dashboardFeatured: document.getElementById('dashboardFeatured'),
        dashboardSuggestions: document.getElementById('dashboardSuggestions'),
        recentActivity: document.getElementById('recentActivity'),
        projectsOnTrackCount: document.getElementById('projectsOnTrackCount'),
        projectsOnTrackMeta: document.getElementById('projectsOnTrackMeta'),
        projectsAttentionCount: document.getElementById('projectsAttentionCount'),
        projectsAttentionMeta: document.getElementById('projectsAttentionMeta'),
        projectsTableBody: document.getElementById('projectsTableBody'),
        candidatesActiveCount: document.getElementById('candidatesActiveCount'),
        candidatesActiveMeta: document.getElementById('candidatesActiveMeta'),
        candidatesPendingFeedbackCount: document.getElementById('candidatesPendingFeedbackCount'),
        candidatesPendingMeta: document.getElementById('candidatesPendingMeta'),
        candidatesTableBody: document.getElementById('candidatesTableBody'),
        positionsOpenCount: document.getElementById('positionsOpenCount'),
        positionsOpenMeta: document.getElementById('positionsOpenMeta'),
        positionsNewCount: document.getElementById('positionsNewCount'),
        positionsNewMeta: document.getElementById('positionsNewMeta'),
        positionsTableBody: document.getElementById('positionsTableBody'),
        aiActiveJobsCount: document.getElementById('aiActiveJobsCount'),
        aiActiveJobsMeta: document.getElementById('aiActiveJobsMeta'),
        aiProfilesCount: document.getElementById('aiProfilesCount'),
        aiProfilesMeta: document.getElementById('aiProfilesMeta'),
        aiTrackedProjectsCount: document.getElementById('aiTrackedProjectsCount'),
        aiTrackedProjectsMeta: document.getElementById('aiTrackedProjectsMeta'),
        aiJobsTableBody: document.getElementById('aiJobsTableBody')
      };

      const viewTitles = {
        dashboard: 'Dashboard overview',
        projects: 'Project portfolio',
        candidates: 'Candidate pipelines',
        positions: 'Open positions',
        'ai-sourcing': 'AI sourcing intelligence',
        settings: 'Workspace preferences'
      };

      const numberFormatter = new Intl.NumberFormat(undefined, { maximumFractionDigits: 0 });

      const state = {
        token: sessionStorage.getItem('recruitproAccessToken') || null,
        loading: false,
        backendUrl: null,
        user: null
      };

      const toTitleCase = (value) => {
        if (!value) return '—';
        return value
          .toString()
          .replace(/[_-]+/g, ' ')
          .replace(/\s+/g, ' ')
          .trim()
          .replace(/\b\w/g, (char) => char.toUpperCase());
      };

      const formatNumber = (value) => numberFormatter.format(Math.max(0, Math.round(value ?? 0)));

      const formatRelativeTime = (input) => {
        if (!input) return 'Just now';
        const timestamp = new Date(input);
        if (Number.isNaN(timestamp.getTime())) {
          return 'Just now';
        }
        const diff = Date.now() - timestamp.getTime();
        if (diff <= 0) {
          return 'Just now';
        }
        const seconds = Math.floor(diff / 1000);
        if (seconds < 60) return 'Just now';
        const minutes = Math.floor(seconds / 60);
        if (minutes < 60) return `${minutes}m ago`;
        const hours = Math.floor(minutes / 60);
        if (hours < 24) return `${hours}h ago`;
        return timestamp.toLocaleDateString();
      };

      const projectAttentionStatuses = new Set(['paused', 'blocked', 'on-hold', 'hold', 'delayed', 'overdue', 'stalled', 'draft', 'needs-attention']);
      const closedProjectStatuses = new Set(['archived', 'closed', 'cancelled', 'canceled']);
      const newPositionStatuses = new Set(['draft', 'intake', 'new', 'requested']);

      const mapBadgeClass = (status) => {
        const value = (status || '').toLowerCase();
        if (!value) return 'badge info';
        if (['offer', 'completed', 'hired', 'success', 'ready', 'active', 'live'].some((key) => value.includes(key))) {
          return 'badge success';
        }
        if (
          ['blocked', 'paused', 'hold', 'delayed', 'overdue', 'failed', 'needs-attention', 'escalated', 'draft'].some((key) =>
            value.includes(key)
          )
        ) {
          return 'badge warning';
        }
        return 'badge info';
      };

      const createBadge = (status) => {
        const badge = document.createElement('span');
        badge.className = mapBadgeClass(status);
        badge.textContent = toTitleCase(status) || '—';
        return badge;
      };

      const resetDynamicContent = () => {
        elements.dashboardProjectsCount.textContent = '0';
        elements.dashboardProjectsMeta.textContent = 'No projects yet';
        elements.dashboardCandidatesCount.textContent = '0';
        elements.dashboardCandidatesMeta.textContent = 'No candidates yet';
        elements.dashboardInterviewsCount.textContent = '0';
        elements.dashboardInterviewsMeta.textContent = 'No interviews scheduled';
        elements.dashboardFeatured.innerHTML =
          '<h4>No candidates spotlighted yet</h4><p>Add candidates to highlight profiles that need your attention.</p>';
        elements.dashboardSuggestions.innerHTML =
          '<li class="empty-state">Sign in to load workspace suggestions.</li>';
        elements.recentActivity.innerHTML =
          '<li class="timeline-item empty"><div><strong>No activity recorded</strong><span>Updates will appear once RecruitPro logs new events.</span></div><span></span></li>';
        activityUpdatedAt.textContent = 'Waiting for updates…';
        elements.projectsOnTrackCount.textContent = '0';
        elements.projectsOnTrackMeta.textContent = 'No data yet';
        elements.projectsAttentionCount.textContent = '0';
        elements.projectsAttentionMeta.textContent = 'Awaiting updates';
        elements.projectsTableBody.innerHTML = '<tr><td colspan="4" class="table-empty">Sign in to load project data.</td></tr>';
        elements.candidatesActiveCount.textContent = '0';
        elements.candidatesActiveMeta.textContent = 'No candidates tracked';
        elements.candidatesPendingFeedbackCount.textContent = '0';
        elements.candidatesPendingMeta.textContent = 'All feedback submitted';
        elements.candidatesTableBody.innerHTML =
          '<tr><td colspan="4" class="table-empty">Candidates will appear once they are added to your workspace.</td></tr>';
        elements.positionsOpenCount.textContent = '0';
        elements.positionsOpenMeta.textContent = 'No open positions';
        elements.positionsNewCount.textContent = '0';
        elements.positionsNewMeta.textContent = 'No new requests';
        elements.positionsTableBody.innerHTML =
          '<tr><td colspan="4" class="table-empty">Create or import positions to see them here.</td></tr>';
        elements.aiActiveJobsCount.textContent = '0';
        elements.aiActiveJobsMeta.textContent = 'No sourcing jobs running';
        elements.aiProfilesCount.textContent = '0';
        elements.aiProfilesMeta.textContent = 'No profiles generated';
        elements.aiTrackedProjectsCount.textContent = '0';
        elements.aiTrackedProjectsMeta.textContent = 'No projects tracked yet';
        elements.aiJobsTableBody.innerHTML =
          '<tr><td colspan="4" class="table-empty">Launch a sourcing job to see campaign progress.</td></tr>';
      };

      const setBackendStatus = (status) => {
        backendStatus.textContent = status;
      };

      const resolveApi = (path = '') => {
        const base = state.backendUrl || window.backendBaseUrl || '';
        if (!path) {
          return base;
        }
        if (path.startsWith('http://') || path.startsWith('https://')) {
          return path;
        }
        if (!base) {
          return path;
        }
        if (path.startsWith('/')) {
          return `${base}${path}`;
        }
        return `${base}/${path}`;
      };

      const ensureBackendUrl = async () => {
        if (state.backendUrl) {
          return state.backendUrl;
        }
        if (window.backendBaseUrl) {
          state.backendUrl = window.backendBaseUrl;
          return state.backendUrl;
        }
        if (window.electronAPI?.getBackendUrl) {
          try {
            const url = await window.electronAPI.getBackendUrl();
            if (url) {
              state.backendUrl = url;
              window.backendBaseUrl = url;
              setBackendStatus(`Connected to ${url}`);
              return state.backendUrl;
            }
          } catch (error) {
            console.warn('Failed to resolve backend URL', error);
          }
        }
        return state.backendUrl || '';
      };

      const setToken = (token) => {
        state.token = token;
        if (token) {
          sessionStorage.setItem('recruitproAccessToken', token);
        } else {
          sessionStorage.removeItem('recruitproAccessToken');
        }
      };

      const handleUnauthorized = () => {
        setToken(null);
        showLogin();
        setBackendStatus('Authentication required');
      };

      const authorizedFetch = async (path, options = {}) => {
        if (!state.token) {
          throw new Error('Not authenticated');
        }
        await ensureBackendUrl();
        const url = resolveApi(path);
        const headers = new Headers(options.headers || {});
        headers.set('Authorization', `Bearer ${state.token}`);
        if (options.body && !(options.body instanceof FormData) && !headers.has('Content-Type')) {
          headers.set('Content-Type', 'application/json');
        }
        const response = await fetch(url, { ...options, headers });
        if (response.status === 401) {
          handleUnauthorized();
          throw new Error('Authentication expired');
        }
        if (!response.ok) {
          const message = await response.text();
          throw new Error(message || `Request failed with status ${response.status}`);
        }
        const contentType = response.headers.get('content-type') || '';
        if (contentType.includes('application/json')) {
          return response.json();
        }
        return response.text();
      };

      const renderDashboard = (stats, activity, projects, candidates, interviews) => {
        const projectList = Array.isArray(projects) ? projects : [];
        const candidateList = Array.isArray(candidates) ? candidates : [];
        const interviewList = Array.isArray(interviews) ? interviews : [];

        const onTrackProjects = projectList.filter((project) => {
          const value = (project.status || '').toLowerCase();
          if (closedProjectStatuses.has(value)) {
            return false;
          }
          if (projectAttentionStatuses.has(value)) {
            return false;
          }
          return true;
        });

        elements.dashboardProjectsCount.textContent = formatNumber(projectList.length);
        elements.dashboardProjectsMeta.textContent = projectList.length
          ? `${formatNumber(onTrackProjects.length)} active of ${formatNumber(projectList.length)} tracked`
          : 'No projects yet';

        const pipeline = stats?.pipeline || {};
        const totalCandidates = pipeline.total ?? candidateList.length ?? 0;
        elements.dashboardCandidatesCount.textContent = formatNumber(totalCandidates);
        elements.dashboardCandidatesMeta.textContent =
          totalCandidates > 0
            ? `Sourcing ${formatNumber(pipeline.sourcing || 0)} • Screening ${formatNumber(pipeline.screening || 0)}`
            : 'No candidates yet';

        const interviewsCount = pipeline.interviews ?? interviewList.length ?? 0;
        elements.dashboardInterviewsCount.textContent = formatNumber(interviewsCount);
        elements.dashboardInterviewsMeta.textContent =
          interviewsCount > 0 || (pipeline.offers ?? 0) > 0
            ? `Offers ${formatNumber(pipeline.offers || 0)} • Sourcing ${formatNumber(pipeline.sourcing || 0)}`
            : 'No interviews scheduled';

        const featuredContainer = elements.dashboardFeatured;
        featuredContainer.innerHTML = '';
        if (stats?.featured_candidate) {
          const candidate = stats.featured_candidate;
          const heading = document.createElement('h4');
          heading.textContent = candidate.name || 'Featured candidate';
          const summary = document.createElement('p');
          summary.textContent = candidate.summary || 'Review the latest candidate insights.';
          featuredContainer.appendChild(heading);
          featuredContainer.appendChild(summary);
          if (Array.isArray(candidate.tags) && candidate.tags.length) {
            const tagList = document.createElement('div');
            tagList.className = 'chip-list';
            candidate.tags.forEach((tag) => {
              const tagChip = document.createElement('span');
              tagChip.className = 'chip';
              tagChip.textContent = tag;
              tagList.appendChild(tagChip);
            });
            featuredContainer.appendChild(tagList);
          }
        } else {
          featuredContainer.innerHTML =
            '<h4>No candidates spotlighted yet</h4><p>Add candidates to highlight profiles that need your attention.</p>';
        }

        const suggestions = Array.isArray(stats?.suggestions) ? stats.suggestions.filter(Boolean) : [];
        const suggestionsList = elements.dashboardSuggestions;
        suggestionsList.innerHTML = '';
        if (suggestions.length === 0) {
          const li = document.createElement('li');
          li.className = 'empty-state';
          li.textContent = 'No suggestions available yet. Engage with your workspace to surface guidance.';
          suggestionsList.appendChild(li);
        } else {
          suggestions.forEach((text) => {
            const li = document.createElement('li');
            li.textContent = text;
            suggestionsList.appendChild(li);
          });
        }

        const activityList = elements.recentActivity;
        activityList.innerHTML = '';
        const activityItems = Array.isArray(activity)
          ? activity.slice().sort((a, b) => new Date(b.created_at) - new Date(a.created_at))
          : [];
        if (activityItems.length === 0) {
          activityList.innerHTML =
            '<li class="timeline-item empty"><div><strong>No activity recorded</strong><span>Updates will appear once RecruitPro logs new events.</span></div><span></span></li>';
          activityUpdatedAt.textContent = 'No activity yet';
        } else {
          activityItems.slice(0, 6).forEach((item) => {
            const li = document.createElement('li');
            li.className = 'timeline-item';
            const wrapper = document.createElement('div');
            const heading = document.createElement('strong');
            heading.textContent = toTitleCase(item.event_type);
            const message = document.createElement('span');
            message.textContent = item.message || '';
            wrapper.appendChild(heading);
            wrapper.appendChild(message);
            const time = document.createElement('span');
            time.textContent = formatRelativeTime(item.created_at);
            li.appendChild(wrapper);
            li.appendChild(time);
            activityList.appendChild(li);
          });
          const latestTimestamp = activityItems[0]?.created_at;
          if (latestTimestamp) {
            const refreshedAt = new Date(latestTimestamp);
            activityUpdatedAt.textContent = `Latest update ${refreshedAt.toLocaleTimeString([], {
              hour: '2-digit',
              minute: '2-digit'
            })}`;
          } else {
            activityUpdatedAt.textContent = 'Recent updates available';
          }
        }
      };

      const renderProjects = (projects) => {
        const rows = Array.isArray(projects)
          ? projects.slice().sort((a, b) => new Date(b.created_at) - new Date(a.created_at))
          : [];
        let onTrack = 0;
        let attention = 0;
        rows.forEach((project) => {
          const status = (project.status || '').toLowerCase();
          if (projectAttentionStatuses.has(status)) {
            attention += 1;
          } else if (!closedProjectStatuses.has(status)) {
            onTrack += 1;
          }
        });

        elements.projectsOnTrackCount.textContent = formatNumber(onTrack);
        elements.projectsOnTrackMeta.textContent = rows.length
          ? `${formatNumber(onTrack)} currently healthy`
          : 'Add a project to get started.';
        elements.projectsAttentionCount.textContent = formatNumber(attention);
        elements.projectsAttentionMeta.textContent = attention
          ? `${formatNumber(attention)} require follow-up`
          : 'No projects flagged.';

        const tbody = elements.projectsTableBody;
        tbody.innerHTML = '';
        if (rows.length === 0) {
          tbody.innerHTML = '<tr><td colspan="4" class="table-empty">Sign in to load project data.</td></tr>';
          return;
        }

        rows.slice(0, 6).forEach((project) => {
          const tr = document.createElement('tr');
          const nameCell = document.createElement('td');
          nameCell.textContent = project.name || 'Untitled project';
          const clientCell = document.createElement('td');
          clientCell.textContent = project.client || '—';
          const statusCell = document.createElement('td');
          statusCell.appendChild(createBadge(project.status));
          const hiresCell = document.createElement('td');
          const target = formatNumber(project.target_hires || 0);
          const hired = formatNumber(project.hires_count || 0);
          hiresCell.textContent = `${target} target • ${hired} hired`;
          tr.appendChild(nameCell);
          tr.appendChild(clientCell);
          tr.appendChild(statusCell);
          tr.appendChild(hiresCell);
          tbody.appendChild(tr);
        });
      };

      const renderCandidates = (candidates, positions, interviews) => {
        const candidateRows = Array.isArray(candidates)
          ? candidates.slice().sort((a, b) => new Date(b.created_at) - new Date(a.created_at))
          : [];
        const positionMap = new Map();
        if (Array.isArray(positions)) {
          positions.forEach((position) => positionMap.set(position.position_id, position));
        }
        const pendingFeedback = candidateRows.filter((candidate) => {
          const status = (candidate.status || '').toLowerCase();
          return status.includes('feedback') || status.includes('pending');
        }).length;
        const projectCount = new Set(candidateRows.map((candidate) => candidate.project_id).filter(Boolean)).size;

        elements.candidatesActiveCount.textContent = formatNumber(candidateRows.length);
        elements.candidatesActiveMeta.textContent =
          candidateRows.length > 0 ? `Across ${formatNumber(projectCount)} projects` : 'No candidates tracked';

        elements.candidatesPendingFeedbackCount.textContent = formatNumber(pendingFeedback);
        elements.candidatesPendingMeta.textContent =
          pendingFeedback > 0 ? `${formatNumber(pendingFeedback)} awaiting feedback` : 'All feedback submitted';

        const tbody = elements.candidatesTableBody;
        tbody.innerHTML = '';
        if (candidateRows.length === 0) {
          tbody.innerHTML =
            '<tr><td colspan="4" class="table-empty">Candidates will appear once they are added to your workspace.</td></tr>';
          return;
        }

        candidateRows.slice(0, 6).forEach((candidate) => {
          const tr = document.createElement('tr');
          const nameCell = document.createElement('td');
          nameCell.textContent = candidate.name || 'Unnamed candidate';
          const roleCell = document.createElement('td');
          const position = candidate.position_id ? positionMap.get(candidate.position_id) : null;
          roleCell.textContent = position?.title || '—';
          const statusCell = document.createElement('td');
          statusCell.appendChild(createBadge(candidate.status));
          const sourceCell = document.createElement('td');
          sourceCell.textContent = candidate.source || '—';
          tr.appendChild(nameCell);
          tr.appendChild(roleCell);
          tr.appendChild(statusCell);
          tr.appendChild(sourceCell);
          tbody.appendChild(tr);
        });
      };

      const renderPositions = (positions) => {
        const rows = Array.isArray(positions)
          ? positions.slice().sort((a, b) => new Date(b.created_at) - new Date(a.created_at))
          : [];
        const openPositions = rows.filter((position) => {
          const value = (position.status || '').toLowerCase();
          return !value || !['closed', 'filled', 'completed', 'archived'].includes(value);
        });
        const newRequests = rows.filter((position) => newPositionStatuses.has((position.status || '').toLowerCase()));

        elements.positionsOpenCount.textContent = formatNumber(openPositions.length);
        elements.positionsOpenMeta.textContent =
          openPositions.length > 0 ? `${formatNumber(openPositions.length)} active roles` : 'No open positions';

        elements.positionsNewCount.textContent = formatNumber(newRequests.length);
        elements.positionsNewMeta.textContent =
          newRequests.length > 0 ? `${formatNumber(newRequests.length)} awaiting kickoff` : 'No new requests';

        const tbody = elements.positionsTableBody;
        tbody.innerHTML = '';
        if (rows.length === 0) {
          tbody.innerHTML =
            '<tr><td colspan="4" class="table-empty">Create or import positions to see them here.</td></tr>';
          return;
        }

        rows.slice(0, 6).forEach((position) => {
          const tr = document.createElement('tr');
          const titleCell = document.createElement('td');
          titleCell.textContent = position.title || 'Untitled role';
          const departmentCell = document.createElement('td');
          departmentCell.textContent = position.department || '—';
          const statusCell = document.createElement('td');
          statusCell.appendChild(createBadge(position.status));
          const openingsCell = document.createElement('td');
          openingsCell.textContent = formatNumber(position.openings ?? 0);
          tr.appendChild(titleCell);
          tr.appendChild(departmentCell);
          tr.appendChild(statusCell);
          tr.appendChild(openingsCell);
          tbody.appendChild(tr);
        });
      };

      const renderSourcing = (overview) => {
        const summary = overview?.summary || {};
        const jobs = Array.isArray(overview?.jobs) ? overview.jobs : [];

        elements.aiActiveJobsCount.textContent = formatNumber(summary.active_jobs || 0);
        elements.aiActiveJobsMeta.textContent =
          summary.total_jobs > 0
            ? `${formatNumber(summary.total_jobs)} total jobs tracked`
            : 'No sourcing jobs running';
        elements.aiProfilesCount.textContent = formatNumber(summary.total_profiles || 0);
        elements.aiProfilesMeta.textContent =
          summary.total_profiles > 0 ? 'Profiles generated by automation' : 'No profiles generated';
        elements.aiTrackedProjectsCount.textContent = formatNumber(summary.tracked_projects || 0);
        elements.aiTrackedProjectsMeta.textContent =
          summary.tracked_projects > 0 ? 'Projects with sourcing automation' : 'No projects tracked yet';

        const tbody = elements.aiJobsTableBody;
        tbody.innerHTML = '';
        if (jobs.length === 0) {
          tbody.innerHTML =
            '<tr><td colspan="4" class="table-empty">Launch a sourcing job to see campaign progress.</td></tr>';
          return;
        }

        jobs.slice(0, 6).forEach((job) => {
          const tr = document.createElement('tr');
          const nameCell = document.createElement('td');
          nameCell.textContent = job.position_title || 'Sourcing job';
          const projectCell = document.createElement('td');
          projectCell.textContent = job.project_name || '—';
          const statusCell = document.createElement('td');
          statusCell.appendChild(createBadge(job.status));
          const progressCell = document.createElement('td');
          const progress = typeof job.progress === 'number' ? `${Math.round(job.progress)}%` : '0%';
          const profiles = formatNumber(job.found_count || 0);
          progressCell.textContent = `${profiles} profiles • ${progress}`;
          tr.appendChild(nameCell);
          tr.appendChild(projectCell);
          tr.appendChild(statusCell);
          tr.appendChild(progressCell);
          tbody.appendChild(tr);
        });
      };

      const loadAppData = async ({ showErrors = false } = {}) => {
        if (!state.token || state.loading) {
          return false;
        }
        state.loading = true;
        setBackendStatus('Syncing data…');
        try {
          await ensureBackendUrl();
          const [user, stats, activity, projects, positions, candidates, interviews, sourcing] = await Promise.all([
            authorizedFetch('/api/user'),
            authorizedFetch('/api/dashboard/stats'),
            authorizedFetch('/api/activity'),
            authorizedFetch('/api/projects'),
            authorizedFetch('/api/positions'),
            authorizedFetch('/api/candidates'),
            authorizedFetch('/api/interviews'),
            authorizedFetch('/api/sourcing/overview')
          ]);
          state.user = user;
          renderDashboard(stats, activity, projects, candidates, interviews);
          renderProjects(projects);
          renderCandidates(candidates, positions, interviews);
          renderPositions(positions);
          renderSourcing(sourcing);
          setBackendStatus(state.backendUrl ? `Connected to ${state.backendUrl}` : 'Connected');
          return true;
        } catch (error) {
          console.error('Failed to load workspace data', error);
          if (showErrors) {
            window.alert(error.message || 'Unable to load workspace data. Please try again.');
          }
          return false;
        } finally {
          state.loading = false;
        }
      };

      const showApp = () => {
        loginScreen.style.display = 'none';
        appLayout.setAttribute('data-state', 'visible');
        activateView('dashboard');
      };

      function showLogin() {
        appLayout.removeAttribute('data-state');
        loginScreen.style.display = 'flex';
        loginForm.reset();
        resetDynamicContent();
      }

      const formatToday = () => {
        const now = new Date();
        return now.toLocaleDateString(undefined, {
          month: 'short',
          day: 'numeric'
        });
      };

      todayDate.textContent = formatToday();

      loginForm.addEventListener('submit', async (event) => {
        event.preventDefault();
        const formData = new FormData(loginForm);
        const email = String(formData.get('email') || '').trim();
        const password = String(formData.get('password') || '').trim();
        if (!email || !password) {
          window.alert('Enter your work email and password to continue.');
          return;
        }

        loginButton.disabled = true;
        const originalLabel = loginButton.textContent;
        loginButton.textContent = 'Signing in…';

        try {
          await ensureBackendUrl();
          const response = await fetch(resolveApi('/api/auth/login'), {
            method: 'POST',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            body: new URLSearchParams({ username: email, password })
          });
          if (!response.ok) {
            const message = await response.text();
            throw new Error(message || 'Login failed.');
          }
          const payload = await response.json();
          if (!payload?.access_token) {
            throw new Error('Login response was missing an access token.');
          }
          setToken(payload.access_token);
          const loaded = await loadAppData({ showErrors: true });
          if (loaded) {
            showApp();
          } else {
            handleUnauthorized();
          }
        } catch (error) {
          console.error('Login failed', error);
          window.alert(error.message || 'Unable to sign in. Please verify your credentials and try again.');
        } finally {
          loginButton.disabled = false;
          loginButton.textContent = originalLabel;
        }
      });

      logoutButton.addEventListener('click', async () => {
        if (state.token) {
          try {
            await authorizedFetch('/api/auth/logout', { method: 'POST' });
          } catch (error) {
            console.warn('Logout request failed', error);
          }
        }
        setToken(null);
        showLogin();
        setBackendStatus('Signed out');
      });

      const activateView = (viewName) => {
        navButtons.forEach((button) => {
          if (button.dataset.viewTarget === viewName) {
            button.classList.add('is-active');
            button.setAttribute('aria-current', 'page');
          } else {
            button.classList.remove('is-active');
            button.removeAttribute('aria-current');
          }
        });

        views.forEach((view) => {
          if (view.dataset.view === viewName) {
            view.setAttribute('data-state', 'active');
          } else {
            view.removeAttribute('data-state');
          }
        });

        viewTitle.textContent = viewTitles[viewName] || 'RecruitPro';
      };

      navButtons.forEach((button) => {
        button.addEventListener('click', () => {
          activateView(button.dataset.viewTarget);
        });
      });

      resetDynamicContent();
      setBackendStatus('Connecting…');

      if (window.electronAPI?.onBackendReady) {
        window.electronAPI.onBackendReady(({ url }) => {
          if (url) {
            state.backendUrl = url;
            window.backendBaseUrl = url;
            setBackendStatus(`Connected to ${url}`);
          } else {
            setBackendStatus('Connected');
          }
          if (state.token) {
            loadAppData().catch((error) => console.error('Failed to refresh data after backend ready', error));
          }
        });
      } else {
        setBackendStatus('Ready');
      }

      if (window.electronAPI?.onBackendExit) {
        window.electronAPI.onBackendExit(({ message }) => {
          setBackendStatus('Disconnected');
          window.alert(message || 'The backend stopped unexpectedly.');
        });
      }

      const initializeFromSession = async () => {
        if (!state.token) {
          showLogin();
          return;
        }
        const loaded = await loadAppData({ showErrors: true });
        if (loaded) {
          showApp();
        } else {
          handleUnauthorized();
        }
      };

      initializeFromSession().catch((error) => {
        console.error('Failed to initialize session', error);
        handleUnauthorized();
      });
    </script>
  </body>
</html>
