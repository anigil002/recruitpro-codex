<!DOCTYPE html>
<html class="dark" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <title>RecruitPro Console</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" />
    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              primary: "#38bdf8",
              surface: "#0f172a",
              surfaceMuted: "#1e293b",
            },
            fontFamily: {
              display: ["Inter", "ui-sans-serif", "system-ui"],
            },
          },
        },
      };
    </script>
    <style>
      :root {
        color-scheme: dark;
      }

      body {
        font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      }

      .material-symbols-outlined {
        font-variation-settings: "FILL" 0, "wght" 500, "GRAD" 0, "opsz" 24;
      }
    </style>
  </head>
  <body class="min-h-screen bg-slate-950 font-display text-slate-100">
    {% set token_query = '' %}
    {% if token %}
    {% set token_query = '?token=' + token %}
    {% endif %}
    <div class="flex min-h-screen">
      <aside class="hidden w-64 flex-col justify-between border-r border-slate-800/60 bg-slate-950/80 px-6 py-8 lg:flex">
        <div class="space-y-8">
          <div class="flex items-center gap-3">
            <span class="flex size-10 items-center justify-center rounded-full bg-primary/10 text-lg font-semibold text-primary"
              >RP</span
            >
            <div>
              <p class="text-xs uppercase tracking-[0.3em] text-slate-400">RecruitPro</p>
              <p class="text-base font-semibold text-white">{{ workspace_name or "Workspace" }}</p>
            </div>
          </div>
          <nav class="space-y-2 text-sm text-slate-300">
            <a class="flex items-center gap-3 rounded-2xl bg-slate-900/80 px-4 py-2 font-medium text-white" href="/app{{ token_query }}">
              <span class="material-symbols-outlined text-xl">space_dashboard</span>
              Console
            </a>
            <a class="flex items-center gap-3 rounded-2xl px-4 py-2 transition hover:bg-slate-900/60" href="/ai/sourcing-overview{{ token_query }}">
              <span class="material-symbols-outlined text-xl">travel_explore</span>
              AI sourcing
            </a>
            <a class="flex items-center gap-3 rounded-2xl px-4 py-2 transition hover:bg-slate-900/60" href="/settings">
              <span class="material-symbols-outlined text-xl">settings</span>
              Settings
            </a>
          </nav>
        </div>
        <div class="flex items-center gap-3 rounded-2xl border border-slate-800/60 bg-slate-900/60 px-4 py-3 text-sm">
          <div class="flex size-10 items-center justify-center rounded-full bg-primary/10 text-sm font-semibold text-primary">
            {{ (user.initials if user else 'RP') }}
          </div>
          <div>
            <p class="font-medium text-white">{{ user.name if user else 'Guest' }}</p>
            <p class="text-xs text-slate-400">{{ user.email if user else 'Authenticate to load data' }}</p>
          </div>
        </div>
      </aside>
      <main class="flex-1 overflow-y-auto">
        <div class="mx-auto flex max-w-6xl flex-col gap-8 px-6 py-8">
          <header class="space-y-2">
            <p class="text-xs uppercase tracking-[0.3em] text-primary">{{ workspace_name or "RecruitPro" }}</p>
            <h1 class="text-3xl font-semibold text-white">Workspace console</h1>
            {% if user %}
            <p class="text-sm text-slate-400">Signed in as {{ user.email }}</p>
            {% else %}
            <p class="text-sm text-slate-400">Authenticate with a valid token to view live workspace data.</p>
            {% endif %}
          </header>

          {% if error %}
          <div class="rounded-2xl border border-amber-400/30 bg-amber-400/10 px-4 py-3 text-sm text-amber-100">{{ error }}</div>
          {% endif %}

          {% if not user %}
          <section class="rounded-3xl border border-slate-800/60 bg-slate-900/60 p-6 text-sm text-slate-300">
            <h2 class="text-lg font-semibold text-white">No workspace data loaded</h2>
            <p class="mt-2">
              Use the login page to obtain an access token, then refresh this page with
              <code class="rounded bg-slate-800 px-2 py-1 text-xs text-slate-200">?token=&lt;your-token&gt;</code> to connect to your
              workspace.
            </p>
          </section>
          {% else %}

          <section class="rounded-3xl border border-slate-800/60 bg-slate-900/60 p-6">
            <header class="flex flex-wrap items-center justify-between gap-3">
              <h2 class="text-lg font-semibold text-white">Workspace snapshot</h2>
            </header>
            <div class="mt-4 grid gap-4 sm:grid-cols-2 xl:grid-cols-4">
              {% for card in stats %}
              <article class="rounded-2xl border border-slate-800/80 bg-slate-950/60 p-4">
                <p class="text-xs uppercase tracking-wide text-slate-400">{{ card.label }}</p>
                <p class="mt-2 text-3xl font-semibold text-white">{{ card.value }}</p>
                {% if card.caption %}
                <p class="mt-1 text-sm text-slate-400">{{ card.caption }}</p>
                {% endif %}
              </article>
              {% endfor %}
            </div>
          </section>

          <div class="grid gap-6 lg:grid-cols-[2fr,1fr]">
            <section class="rounded-3xl border border-slate-800/60 bg-slate-900/60 p-6">
              <header class="flex items-center justify-between">
                <h2 class="text-lg font-semibold text-white">Projects</h2>
              </header>
              {% if projects %}
              <ul class="mt-4 divide-y divide-slate-800/60">
                {% for project in projects %}
                <li class="flex flex-col gap-3 py-4 md:flex-row md:items-center md:justify-between">
                  <div>
                    <p class="text-base font-semibold text-white">{{ project.name }}</p>
                    <p class="text-sm text-slate-400">
                      {{ project.status|title }}{% if project.client %} • {{ project.client }}{% endif %}
                      {% if project.location_region %} • {{ project.location_region }}{% endif %}
                    </p>
                    <p class="text-xs text-slate-500">
                      Created {{ project.created_at.strftime('%Y-%m-%d %H:%M') if project.created_at else '—' }}
                    </p>
                  </div>
                  <div class="flex flex-wrap items-center gap-3 text-xs text-slate-300">
                    <span>Open positions: {{ project.open_positions }}</span>
                    <span>Total roles: {{ project.positions_count }}</span>
                    <span>Candidates: {{ project.candidate_count }}</span>
                    <a
                      class="inline-flex items-center gap-1 rounded-full border border-primary/40 bg-primary/10 px-3 py-1 font-medium text-primary"
                      href="/project-overview?project_id={{ project.project_id }}{% if token %}&token={{ token }}{% endif %}"
                    >
                      Open
                    </a>
                  </div>
                </li>
                {% endfor %}
              </ul>
              {% else %}
              <p class="mt-4 text-sm text-slate-400">
                No projects yet. Create one using the API or admin utilities to populate this list.
              </p>
              {% endif %}
            </section>

            <section class="rounded-3xl border border-slate-800/60 bg-slate-900/60 p-6">
              <header class="flex items-center justify-between">
                <h2 class="text-lg font-semibold text-white">Candidate pipeline</h2>
              </header>
              {% if candidate_status %}
              <ul class="mt-4 grid gap-3 sm:grid-cols-2">
                {% for item in candidate_status %}
                <li class="rounded-2xl border border-slate-800/70 bg-slate-950/60 p-4">
                  <p class="text-xs uppercase tracking-wide text-slate-400">{{ item.status|title }}</p>
                  <p class="mt-2 text-2xl font-semibold text-white">{{ item.count }}</p>
                </li>
                {% endfor %}
              </ul>
              {% else %}
              <p class="mt-4 text-sm text-slate-400">No candidates tracked yet. Add candidates to your projects to see pipeline activity.</p>
              {% endif %}
            </section>
          </div>

          <div class="grid gap-6 lg:grid-cols-[3fr,2fr]">
            <section class="rounded-3xl border border-slate-800/60 bg-slate-900/60 p-6">
              <header class="flex items-center justify-between">
                <h2 class="text-lg font-semibold text-white">Positions</h2>
                <a class="text-sm text-primary hover:underline" href="/project-positions{{ token_query }}">View all</a>
              </header>
              {% if positions %}
              <div class="mt-4 overflow-x-auto">
                <table class="min-w-full divide-y divide-slate-800 text-sm">
                  <thead class="bg-slate-950/60 text-xs uppercase tracking-wide text-slate-400">
                    <tr>
                      <th class="px-4 py-3 text-left">Position</th>
                      <th class="px-4 py-3 text-left">Project</th>
                      <th class="px-4 py-3 text-left">Status</th>
                      <th class="px-4 py-3 text-left">Applicants</th>
                      <th class="px-4 py-3 text-left">Created</th>
                    </tr>
                  </thead>
                  <tbody class="divide-y divide-slate-800/70 text-slate-300">
                    {% for position in positions %}
                    <tr class="hover:bg-slate-900/70">
                      <td class="px-4 py-4">
                        <div>
                          <p class="font-medium text-white">{{ position.title }}</p>
                          <p class="text-xs text-slate-400">
                            {{ position.department or 'Department TBD' }}{% if position.location %} • {{ position.location }}{% endif %}
                          </p>
                        </div>
                      </td>
                      <td class="px-4 py-4 text-sm">{{ position.project_name or '—' }}</td>
                      <td class="px-4 py-4">
                        <span class="inline-flex items-center rounded-full bg-primary/10 px-3 py-1 text-xs font-semibold text-primary">
                          {{ position.status|title }}
                        </span>
                      </td>
                      <td class="px-4 py-4 text-sm">{{ position.applicants_count }}</td>
                      <td class="px-4 py-4 text-sm">
                        {{ position.created_at.strftime('%Y-%m-%d') if position.created_at else '—' }}
                      </td>
                    </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
              {% else %}
              <p class="mt-4 text-sm text-slate-400">No positions captured yet. Add positions to your projects to populate this table.</p>
              {% endif %}
            </section>

            <section class="rounded-3xl border border-slate-800/60 bg-slate-900/60 p-6">
              <header class="flex items-center justify-between">
                <h2 class="text-lg font-semibold text-white">Recent candidates</h2>
              </header>
              {% if recent_candidates %}
              <ul class="mt-4 space-y-3 text-sm">
                {% for candidate in recent_candidates %}
                <li class="rounded-2xl border border-slate-800/70 bg-slate-950/60 p-4">
                  <div class="flex items-start justify-between gap-3">
                    <div>
                      <p class="text-base font-semibold text-white">{{ candidate.name }}</p>
                      <p class="text-xs text-slate-400">
                        {{ candidate.project_name or 'Unassigned project' }}{% if candidate.position_title %} • {{ candidate.position_title }}{% endif %}
                      </p>
                      <p class="text-xs text-slate-500">
                        Source {{ candidate.source or 'Unknown' }} •
                        {{ candidate.created_at.strftime('%Y-%m-%d %H:%M') if candidate.created_at else '—' }}
                      </p>
                    </div>
                    <span class="rounded-full bg-primary/10 px-3 py-1 text-xs font-semibold text-primary">{{ candidate.status|title }}</span>
                  </div>
                  <div class="mt-3 text-xs">
                    <a
                      class="text-primary hover:underline"
                      href="/candidate-profile?candidate_id={{ candidate.candidate_id }}{% if token %}&token={{ token }}{% endif %}"
                      target="_blank"
                      rel="noreferrer"
                    >
                      View profile
                    </a>
                  </div>
                </li>
                {% endfor %}
              </ul>
              {% else %}
              <p class="mt-4 text-sm text-slate-400">No recent candidates yet.</p>
              {% endif %}
            </section>
          </div>

          <section class="rounded-3xl border border-slate-800/60 bg-slate-900/60 p-6">
            <header class="flex flex-wrap items-center justify-between gap-3">
              <div>
                <h2 class="text-lg font-semibold text-white">AI sourcing</h2>
                <p class="text-sm text-slate-400">Summary of sourcing jobs across your workspace.</p>
              </div>
              <a class="text-sm text-primary hover:underline" href="/ai/sourcing-overview{{ token_query }}">Open overview</a>
            </header>
            <div class="mt-4 grid gap-4 sm:grid-cols-2 xl:grid-cols-4">
              <article class="rounded-2xl border border-slate-800/70 bg-slate-950/60 p-4">
                <p class="text-xs uppercase tracking-wide text-slate-400">Total jobs</p>
                <p class="mt-2 text-2xl font-semibold text-white">{{ sourcing.summary.total_jobs }}</p>
              </article>
              <article class="rounded-2xl border border-slate-800/70 bg-slate-950/60 p-4">
                <p class="text-xs uppercase tracking-wide text-slate-400">Active</p>
                <p class="mt-2 text-2xl font-semibold text-white">{{ sourcing.summary.active_jobs }}</p>
              </article>
              <article class="rounded-2xl border border-slate-800/70 bg-slate-950/60 p-4">
                <p class="text-xs uppercase tracking-wide text-slate-400">Profiles generated</p>
                <p class="mt-2 text-2xl font-semibold text-white">{{ sourcing.summary.total_profiles }}</p>
              </article>
              <article class="rounded-2xl border border-slate-800/70 bg-slate-950/60 p-4">
                <p class="text-xs uppercase tracking-wide text-slate-400">Projects tracked</p>
                <p class="mt-2 text-2xl font-semibold text-white">{{ sourcing.summary.tracked_projects }}</p>
              </article>
            </div>
            {% if sourcing.jobs %}
            <ul class="mt-4 divide-y divide-slate-800/60 text-sm">
              {% for job in sourcing.jobs %}
              <li class="flex flex-col gap-2 py-3 md:flex-row md:items-center md:justify-between">
                <div>
                  <p class="font-medium text-white">{{ job.position_title }}</p>
                  <p class="text-xs text-slate-400">{{ job.project_name }} • Profiles {{ job.found_count }} • Progress {{ job.progress }}%</p>
                  <p class="text-xs text-slate-500">
                    Started {{ job.created_at.strftime('%Y-%m-%d %H:%M') if job.created_at else '—' }}{% if job.updated_at %} • Updated {{ job.updated_at.strftime('%Y-%m-%d %H:%M') }}{% endif %}
                  </p>
                </div>
                <span class="inline-flex items-center rounded-full bg-primary/10 px-3 py-1 text-xs font-semibold text-primary">{{ job.status|title }}</span>
              </li>
              {% endfor %}
            </ul>
            {% else %}
            <p class="mt-4 text-sm text-slate-400">No sourcing jobs yet. Launch one to see progress here.</p>
            {% endif %}
          </section>

          <div class="grid gap-6 lg:grid-cols-2">
            <section class="rounded-3xl border border-slate-800/60 bg-slate-900/60 p-6">
              <header class="flex items-center justify-between">
                <h2 class="text-lg font-semibold text-white">Recent activity</h2>
              </header>
              {% if activity %}
              <ul class="mt-4 space-y-3 text-sm">
                {% for item in activity %}
                <li class="rounded-2xl border border-slate-800/70 bg-slate-950/60 p-4">
                  <p class="text-slate-200">{{ item.message }}</p>
                  <p class="text-xs text-slate-500">
                    {{ item.event_type|replace('_', ' ')|title }}
                    {% if item.project_name %}• {{ item.project_name }}{% endif %}
                    • {{ item.created_at.strftime('%Y-%m-%d %H:%M') if item.created_at else '—' }}
                  </p>
                </li>
                {% endfor %}
              </ul>
              {% else %}
              <p class="mt-4 text-sm text-slate-400">No activity recorded for your projects yet.</p>
              {% endif %}
            </section>

            <section class="rounded-3xl border border-slate-800/60 bg-slate-900/60 p-6">
              <header class="flex items-center justify-between">
                <h2 class="text-lg font-semibold text-white">Latest documents</h2>
              </header>
              {% if documents %}
              <ul class="mt-4 space-y-3 text-sm">
                {% for doc in documents %}
                <li class="rounded-2xl border border-slate-800/70 bg-slate-950/60 p-4">
                  <p class="font-medium text-white">{{ doc.filename }}</p>
                  <p class="text-xs text-slate-400">
                    {{ doc.project_name or 'Workspace' }} • {{ doc.uploaded_at.strftime('%Y-%m-%d %H:%M') if doc.uploaded_at else 'recently' }}
                  </p>
                  <a class="mt-2 inline-flex items-center gap-1 text-xs text-primary hover:underline" href="{{ doc.file_url }}" target="_blank" rel="noreferrer">
                    Open file
                    <span class="material-symbols-outlined text-sm">open_in_new</span>
                  </a>
                </li>
                {% endfor %}
              </ul>
              {% else %}
              <p class="mt-4 text-sm text-slate-400">Upload project documents to see them here.</p>
              {% endif %}
            </section>
          </div>

          <section class="rounded-3xl border border-slate-800/60 bg-slate-900/60 p-6">
            <header class="flex items-center justify-between">
              <h2 class="text-lg font-semibold text-white">Upcoming interviews</h2>
            </header>
            {% if interviews %}
            <ul class="mt-4 space-y-3 text-sm">
              {% for interview in interviews %}
              <li class="rounded-2xl border border-slate-800/70 bg-slate-950/60 p-4">
                <div class="flex flex-wrap items-center justify-between gap-3">
                  <div>
                    <p class="font-semibold text-white">{{ interview.candidate_name }}</p>
                    <p class="text-xs text-slate-400">
                      {{ interview.position_title or 'Role TBD' }}{% if interview.project_name %} • {{ interview.project_name }}{% endif %}
                    </p>
                  </div>
                  <span class="rounded-full bg-primary/10 px-3 py-1 text-xs font-semibold text-primary">
                    {{ interview.scheduled_at.strftime('%Y-%m-%d %H:%M') if interview.scheduled_at else 'Scheduled' }}
                  </span>
                </div>
                {% if interview.location or interview.mode %}
                <p class="mt-2 text-xs text-slate-500">
                  {{ interview.mode or 'Mode TBD' }}{% if interview.location %} • {{ interview.location }}{% endif %}
                </p>
                {% endif %}
                {% if interview.notes %}
                <p class="mt-2 text-xs text-slate-400">{{ interview.notes }}</p>
                {% endif %}
              </li>
              {% endfor %}
            </ul>
            {% else %}
            <p class="mt-4 text-sm text-slate-400">No interviews scheduled yet.</p>
            {% endif %}
          </section>

          {% endif %}
        </div>
      </main>
    </div>
    <script>
      const TOKEN_STORAGE_KEY = "recruitpro.token";
      document.addEventListener("DOMContentLoaded", () => {
        try {
          const stored = window.localStorage?.getItem(TOKEN_STORAGE_KEY);
          if (stored) {
            const url = new URL(window.location.href);
            if (!url.searchParams.get("token")) {
              url.searchParams.set("token", stored);
              window.location.replace(url.toString());
            }
          }
        } catch (err) {
          console.warn("Unable to synchronise stored token", err);
        }
      });
    </script>
  </body>
</html>
